<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">
    <title>get crud</title>
</head>

<body>
    <%- include ("./partial/header.ejs") -%>

        <div class="container">
            <h1>Get all users</h1>
            <form action="" method="POST" class="form-action"></form>
            <table class="table table-hover table-dark">
                <thead>
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">Email</th>
                        <th scope="col">First Name</th>
                        <th scope="col">Last Name</th>
                        <th scope="col">Action</th>
                    </tr>
                </thead>
                <% for(var i=0; i < users.length; i++) { %>
                    <tr>
                        <td>
                            <%= users[i].id %>
                        </td>
                        <td>
                            <%= users[i].email %>
                        </td>
                        <td>
                            <%= users[i].firstName %>
                        </td>
                        <td>
                            <%= users[i].lastName %>
                        </td>
                        <td>
                            <button type="button" class="btn btn-edit btn-primary"
                                data-id="<%= users[i].id %>">Edit</button>
                            <a href="/delete-crud?id=<%= users[i].id %>" type="button"
                                class="btn btn-delete btn-danger">Delete</a>
                        </td>

                    </tr>
                    <% } %>
            </table>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.slim.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"></script>

        <script>
            const $ = document.querySelector.bind(document)
            const $$ = document.querySelectorAll.bind(document)


            document.addEventListener('DOMContentLoaded', function (event) {
                const btnEdits = $$('.btn-edit')
                const btnDeletes = $$('.btn-delete')
                const formAction = $('.form-action')

                Array.from(btnEdits).forEach(btnEdit => {
                    btnEdit.onclick = () => {
                        formAction.method = 'GET'
                        formAction.action = '/edit-crud/' + btnEdit.dataset.id
                        formAction.submit()
                    }
                })

            })
        </script>
</body>

</html>